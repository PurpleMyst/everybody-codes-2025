import math
from typing import DefaultDict

BOLD_GREEN = "\x1b[1;32m"
BOLD_RED = "\x1b[1;31m"
BOLD_MAGENTA = "\x1b[1;35m"
BOLD_BLUE = "\x1b[1;34m"
BOLD_CYAN = "\x1b[1;36m"
DIM_YELLOW = "\x1b[2;33m"
RESET = "\x1b[0m"


def bits(mask):
    while mask:
        b = mask & -mask
        yield b.bit_length() - 1
        mask ^= b


def execute_phase(dif: list[int]) -> int:
    l = len(dif)
    rounds = 0

    stop = False
    while not stop:
        stop = True
        it = iter(range(l))
        while (i := next(it, l)) < l:
            if dif[i] > 0:
                j = next((k for k in it if dif[k] <= -1), l)
                if i != l:
                    dif[i] -= 1
                    stop = False
                if i != 0:
                    dif[i - 1] += 1
                    stop = False
                if j != l:
                    dif[j] += 1
                    stop = False
                if j != 0:
                    dif[j - 1] -= 1
                    stop = False
        if not stop:
            rounds += 1
    return rounds


def invert(dif: list[int]) -> None:
    dif[:] = [-d for d in reversed(dif)]


def main() -> None:
    xs = [
        [9, 1, 1, 4, 9, 6],
        [805, 706, 179, 48, 158, 150, 232, 885, 598, 524, 423],
        list(map(int, open("src/part2.txt"))),
        [1032310148, -1716792066, 84867355, -1543172380, -437160605, 1842136290, -610627644, -1202833648, 645101211, 345810350, 1599944487, -1795879433, 1549756269, -1452394105, -530679385, 258347354, -507080800, -1283774079, 1429586868, 1369958989, 470232107, 1771126598, -839919766, -1504829070, 0, -1478506264, 1550148000, -131505511, 325690052, 106845676, 1319430515, 185212263, -1202254361, -1098174130, 713854548, 1, 1332986773, 1054460714, -1631936818, 2039720485, 1833806901, 1610552241, -777599313, -1603225865, -1964801764, 1691722965, -1037382944, 1297593514, 18036706, 1223381871, -2027190574, 901701458, -874922174, -1106732162, 1693613543, 220327512, -1908311524, -1002590840, 1939690461, -1053663531, -525669186, -562679531, 0, 1528694658, -93693305, 1568202358, 1330789025, -1652764248, 2057419447, -1312375576, -1553197339, 225000809, 1774807811, -1043274681, -1370707909, -263795279, -1159809392, 1377015528, -1105830755, -883919982, -1429724699, -841719972, -814740018, -1364231639, -1187379486, 650232714, -50171873, -289883421, 1387105232, -1187436872, -591720409, -1018360732, 322748723, -51536655, 1422250006, -1637004775, -951204807, 197251051, -409740346],
    ][-1]
    dif = [a - b for a, b in zip(xs, xs[1:])]
    rounds = 0
    print(f"{BOLD_BLUE}PHASE 1{RESET}")
    rounds += execute_phase(dif)
    invert(dif)
    print(f"{BOLD_BLUE}PHASE 2{RESET}")
    rounds += execute_phase(dif)
    print(f"{rounds=}")


if __name__ == "__main__":
    main()
